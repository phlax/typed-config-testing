{"$schema": "http://json-schema.org/draft-04/schema#", "properties": {"common_http_protocol_options": {"properties": {"idle_timeout": {"properties": {"seconds": {"type": "string", "description": "Signed seconds of the span of time. Must be from -315,576,000,000\n to +315,576,000,000 inclusive. Note: these bounds are computed from:\n 60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years"}, "nanos": {"type": "integer", "description": "Signed fractions of a second at nanosecond resolution of the span\n of time. Durations less than one second are represented with a 0\n `seconds` field and a positive or negative `nanos` field. For durations\n of one second or more, a non-zero value for the `nanos` field must be\n of the same sign as the `seconds` field. Must be from -999,999,999\n to +999,999,999 inclusive."}}, "additionalProperties": true, "type": "object", "description": "The idle timeout for connections. The idle timeout is defined as the\n period in which there are no active requests. When the\n idle timeout is reached the connection will be closed. If the connection is an HTTP/2\n downstream connection a drain sequence will occur prior to closing the connection, see\n :ref:`drain_timeout\n <envoy_api_field_extensions.filters.network.http_connection_manager.v3.HttpConnectionManager.drain_timeout>`.\n Note that request based timeouts mean that HTTP/2 PINGs will not keep the connection alive.\n If not specified, this defaults to 1 hour. To disable idle timeouts explicitly set this to 0.\n\n .. warning::\n   Disabling this timeout has a highly likelihood of yielding connection leaks due to lost TCP\n   FIN packets, etc.\n\n If the :ref:`overload action <config_overload_manager_overload_actions>` \"envoy.overload_actions.reduce_timeouts\"\n is configured, this timeout is scaled for downstream connections according to the value for\n :ref:`HTTP_DOWNSTREAM_CONNECTION_IDLE <envoy_api_enum_value_config.overload.v3.ScaleTimersOverloadActionConfig.TimerType.HTTP_DOWNSTREAM_CONNECTION_IDLE>`."}, "max_connection_duration": {"properties": {"seconds": {"type": "string", "description": "Signed seconds of the span of time. Must be from -315,576,000,000\n to +315,576,000,000 inclusive. Note: these bounds are computed from:\n 60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years"}, "nanos": {"type": "integer", "description": "Signed fractions of a second at nanosecond resolution of the span\n of time. Durations less than one second are represented with a 0\n `seconds` field and a positive or negative `nanos` field. For durations\n of one second or more, a non-zero value for the `nanos` field must be\n of the same sign as the `seconds` field. Must be from -999,999,999\n to +999,999,999 inclusive."}}, "additionalProperties": true, "type": "object", "description": "The maximum duration of a connection. The duration is defined as a period since a connection\n was established. If not set, there is no max duration. When max_connection_duration is reached\n the connection will be closed. Drain sequence will occur prior to closing the connection if\n if's applicable. See :ref:`drain_timeout\n <envoy_api_field_extensions.filters.network.http_connection_manager.v3.HttpConnectionManager.drain_timeout>`.\n Note: not implemented for upstream connections."}, "max_headers_count": {"additionalProperties": true, "type": "integer", "description": "The maximum number of headers. If unconfigured, the default\n maximum number of request headers allowed is 100. Requests that exceed this limit will receive\n a 431 response for HTTP/1.x and cause a stream reset for HTTP/2."}, "max_stream_duration": {"properties": {"seconds": {"type": "string", "description": "Signed seconds of the span of time. Must be from -315,576,000,000\n to +315,576,000,000 inclusive. Note: these bounds are computed from:\n 60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years"}, "nanos": {"type": "integer", "description": "Signed fractions of a second at nanosecond resolution of the span\n of time. Durations less than one second are represented with a 0\n `seconds` field and a positive or negative `nanos` field. For durations\n of one second or more, a non-zero value for the `nanos` field must be\n of the same sign as the `seconds` field. Must be from -999,999,999\n to +999,999,999 inclusive."}}, "additionalProperties": true, "type": "object", "description": "Total duration to keep alive an HTTP request/response stream. If the time limit is reached the stream will be\n reset independent of any other timeouts. If not specified, this value is not set."}, "headers_with_underscores_action": {"enum": ["ALLOW", 0, "REJECT_REQUEST", 1, "DROP_HEADER", 2], "oneOf": [{"type": "string"}, {"type": "integer"}], "description": "Action to take when a client request with a header name containing underscore characters is received.\n If this setting is not specified, the value defaults to ALLOW.\n Note: upstream responses are not affected by this setting."}}, "additionalProperties": true, "type": "object", "description": "This contains options common across HTTP/1 and HTTP/2"}, "upstream_http_protocol_options": {"properties": {"auto_sni": {"type": "boolean", "description": "Set transport socket `SNI <https://en.wikipedia.org/wiki/Server_Name_Indication>`_ for new\n upstream connections based on the downstream HTTP host/authority header, as seen by the\n :ref:`router filter <config_http_filters_router>`."}, "auto_san_validation": {"type": "boolean", "description": "Automatic validate upstream presented certificate for new upstream connections based on the\n downstream HTTP host/authority header, as seen by the\n :ref:`router filter <config_http_filters_router>`.\n This field is intended to set with `auto_sni` field."}}, "additionalProperties": true, "type": "object", "description": "This contains common protocol options which are only applied upstream."}, "explicit_http_config": {"properties": {"http_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http1ProtocolOptions.jsonschema", "additionalProperties": true}, "http2_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http2ProtocolOptions.jsonschema", "additionalProperties": true}}, "additionalProperties": true, "type": "object", "description": "To explicitly configure either HTTP/1 or HTTP/2 (but not both!) use *explicit_http_config*.\n If the *explicit_http_config* is empty, HTTP/1.1 is used."}, "use_downstream_protocol_config": {"properties": {"http_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http1ProtocolOptions.jsonschema", "additionalProperties": true}, "http2_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http2ProtocolOptions.jsonschema", "additionalProperties": true}}, "additionalProperties": true, "type": "object", "description": "This allows switching on protocol based on what protocol the downstream\n connection used."}, "auto_config": {"properties": {"http_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http1ProtocolOptions.jsonschema", "additionalProperties": true}, "http2_protocol_options": {"$ref": "https://phlax.github.io/typed-config-testing/envoy.config.core.v3/Http2ProtocolOptions.jsonschema", "additionalProperties": true}}, "additionalProperties": true, "type": "object", "description": "This allows switching on protocol based on ALPN"}}, "additionalProperties": true, "type": "object", "description": "[#protodoc-title: HTTP Protocol Options]\n [#extension: envoy.upstreams.http.http_protocol_options]\n\nHttpProtocolOptions specifies Http upstream protocol options. This object\n is used in\n :ref:`typed_extension_protocol_options<envoy_api_field_config.cluster.v3.Cluster.typed_extension_protocol_options>`,\n keyed by the name `envoy.extensions.upstreams.http.v3.HttpProtocolOptions`.\n\n This controls what protocol(s) should be used for upstream and how said protocol(s) are configured.\n\n This replaces the prior pattern of explicit protocol configuration directly\n in the cluster. So a configuration like this, explicitly configuring the use of HTTP/2 upstream:\n\n .. code::\n\n   clusters:\n     - name: some_service\n       connect_timeout: 5s\n       upstream_http_protocol_options:\n         auto_sni: true\n       common_http_protocol_options:\n         idle_timeout: 1s\n       http2_protocol_options:\n         max_concurrent_streams: 100\n        .... [further cluster config]\n\n Would now look like this:\n\n .. code::\n\n   clusters:\n     - name: some_service\n       connect_timeout: 5s\n       typed_extension_protocol_options:\n         envoy.extensions.upstreams.http.v3.HttpProtocolOptions:\n           \"@type\": type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions\n           upstream_http_protocol_options:\n             auto_sni: true\n           common_http_protocol_options:\n             idle_timeout: 1s\n           explicit_http_config:\n             http2_protocol_options:\n               max_concurrent_streams: 100\n        .... [further cluster config]\n [#next-free-field: 6]", "definitions": {"envoy.config.core.v3.Http1ProtocolOptions": {"$schema": "http://json-schema.org/draft-04/schema#", "properties": {"allow_absolute_url": {"additionalProperties": true, "type": "boolean", "description": "Handle HTTP requests with absolute URLs in the requests. These requests\n are generally sent by clients to forward/explicit proxies. This allows clients to configure\n envoy as their HTTP proxy. In Unix, for example, this is typically done by setting the\n *http_proxy* environment variable."}, "accept_http_10": {"type": "boolean", "description": "Handle incoming HTTP/1.0 and HTTP 0.9 requests.\n This is off by default, and not fully standards compliant. There is support for pre-HTTP/1.1\n style connect logic, dechunking, and handling lack of client host iff\n *default_host_for_http_10* is configured."}, "default_host_for_http_10": {"type": "string", "description": "A default host for HTTP/1.0 requests. This is highly suggested if *accept_http_10* is true as\n Envoy does not otherwise support HTTP/1.0 without a Host header.\n This is a no-op if *accept_http_10* is not true."}, "header_key_format": {"properties": {"proper_case_words": {"additionalProperties": true, "type": "object", "description": "Formats the header by proper casing words: the first character and any character following\n a special character will be capitalized if it's an alpha character. For example,\n \"content-type\" becomes \"Content-Type\", and \"foo$b#$are\" becomes \"Foo$B#$Are\".\n Note that while this results in most headers following conventional casing, certain headers\n are not covered. For example, the \"TE\" header will be formatted as \"Te\"."}}, "additionalProperties": true, "type": "object", "description": "Describes how the keys for response headers should be formatted. By default, all header keys\n are lower cased."}, "enable_trailers": {"type": "boolean", "description": "Enables trailers for HTTP/1. By default the HTTP/1 codec drops proxied trailers.\n\n .. attention::\n\n   Note that this only happens when Envoy is chunk encoding which occurs when:\n   - The request is HTTP/1.1.\n   - Is neither a HEAD only request nor a HTTP Upgrade.\n   - Not a response to a HEAD request.\n   - The content length header is not present."}, "allow_chunked_length": {"type": "boolean", "description": "Allows Envoy to process requests/responses with both `Content-Length` and `Transfer-Encoding`\n headers set. By default such messages are rejected, but if option is enabled - Envoy will\n remove Content-Length header and process message.\n See `RFC7230, sec. 3.3.3 <https://tools.ietf.org/html/rfc7230#section-3.3.3>` for details.\n\n .. attention::\n   Enabling this option might lead to request smuggling vulnerability, especially if traffic\n   is proxied via multiple layers of proxies."}, "override_stream_error_on_invalid_http_message": {"additionalProperties": true, "type": "boolean", "description": "Allows invalid HTTP messaging. When this option is false, then Envoy will terminate\n HTTP/1.1 connections upon receiving an invalid HTTP message. However,\n when this option is true, then Envoy will leave the HTTP/1.1 connection\n open where possible.\n If set, this overrides any HCM :ref:`stream_error_on_invalid_http_messaging\n <envoy_v3_api_field_extensions.filters.network.http_connection_manager.v3.HttpConnectionManager.stream_error_on_invalid_http_message>`."}}, "additionalProperties": true, "type": "object", "description": "[#next-free-field: 8]", "id": "envoy.config.core.v3.Http1ProtocolOptions"}, "envoy.config.core.v3.Http2ProtocolOptions": {"$schema": "http://json-schema.org/draft-04/schema#", "properties": {"hpack_table_size": {"additionalProperties": true, "type": "integer", "description": "`Maximum table size <https://httpwg.org/specs/rfc7541.html#rfc.section.4.2>`_\n (in octets) that the encoder is permitted to use for the dynamic HPACK table. Valid values\n range from 0 to 4294967295 (2^32 - 1) and defaults to 4096. 0 effectively disables header\n compression."}, "max_concurrent_streams": {"additionalProperties": true, "type": "integer", "description": "`Maximum concurrent streams <https://httpwg.org/specs/rfc7540.html#rfc.section.5.1.2>`_\n allowed for peer on one HTTP/2 connection. Valid values range from 1 to 2147483647 (2^31 - 1)\n and defaults to 2147483647.\n\n For upstream connections, this also limits how many streams Envoy will initiate concurrently\n on a single connection. If the limit is reached, Envoy may queue requests or establish\n additional connections (as allowed per circuit breaker limits)."}, "initial_stream_window_size": {"additionalProperties": true, "type": "integer", "description": "`Initial stream-level flow-control window\n <https://httpwg.org/specs/rfc7540.html#rfc.section.6.9.2>`_ size. Valid values range from 65535\n (2^16 - 1, HTTP/2 default) to 2147483647 (2^31 - 1, HTTP/2 maximum) and defaults to 268435456\n (256 * 1024 * 1024).\n\n NOTE: 65535 is the initial window size from HTTP/2 spec. We only support increasing the default\n window size now, so it's also the minimum.\n\n This field also acts as a soft limit on the number of bytes Envoy will buffer per-stream in the\n HTTP/2 codec buffers. Once the buffer reaches this pointer, watermark callbacks will fire to\n stop the flow of data to the codec buffers."}, "initial_connection_window_size": {"additionalProperties": true, "type": "integer", "description": "Similar to *initial_stream_window_size*, but for connection-level flow-control\n window. Currently, this has the same minimum/maximum/default as *initial_stream_window_size*."}, "allow_connect": {"type": "boolean", "description": "Allows proxying Websocket and other upgrades over H2 connect."}, "allow_metadata": {"type": "boolean", "description": "[#not-implemented-hide:] Hiding until envoy has full metadata support.\n Still under implementation. DO NOT USE.\n\n Allows metadata. See [metadata\n docs](https://github.com/envoyproxy/envoy/blob/master/source/docs/h2_metadata.md) for more\n information."}, "max_outbound_frames": {"additionalProperties": true, "type": "integer", "description": "Limit the number of pending outbound downstream frames of all types (frames that are waiting to\n be written into the socket). Exceeding this limit triggers flood mitigation and connection is\n terminated. The ``http2.outbound_flood`` stat tracks the number of terminated connections due\n to flood mitigation. The default limit is 10000.\n NOTE: flood and abuse mitigation for upstream connections is presently enabled by the\n `envoy.reloadable_features.upstream_http2_flood_checks` flag."}, "max_outbound_control_frames": {"additionalProperties": true, "type": "integer", "description": "Limit the number of pending outbound downstream frames of types PING, SETTINGS and RST_STREAM,\n preventing high memory utilization when receiving continuous stream of these frames. Exceeding\n this limit triggers flood mitigation and connection is terminated. The\n ``http2.outbound_control_flood`` stat tracks the number of terminated connections due to flood\n mitigation. The default limit is 1000.\n NOTE: flood and abuse mitigation for upstream connections is presently enabled by the\n `envoy.reloadable_features.upstream_http2_flood_checks` flag."}, "max_consecutive_inbound_frames_with_empty_payload": {"additionalProperties": true, "type": "integer", "description": "Limit the number of consecutive inbound frames of types HEADERS, CONTINUATION and DATA with an\n empty payload and no end stream flag. Those frames have no legitimate use and are abusive, but\n might be a result of a broken HTTP/2 implementation. The `http2.inbound_empty_frames_flood``\n stat tracks the number of connections terminated due to flood mitigation.\n Setting this to 0 will terminate connection upon receiving first frame with an empty payload\n and no end stream flag. The default limit is 1.\n NOTE: flood and abuse mitigation for upstream connections is presently enabled by the\n `envoy.reloadable_features.upstream_http2_flood_checks` flag."}, "max_inbound_priority_frames_per_stream": {"additionalProperties": true, "type": "integer", "description": "Limit the number of inbound PRIORITY frames allowed per each opened stream. If the number\n of PRIORITY frames received over the lifetime of connection exceeds the value calculated\n using this formula::\n\n     max_inbound_priority_frames_per_stream * (1 + inbound_streams)\n\n the connection is terminated. The ``http2.inbound_priority_frames_flood`` stat tracks\n the number of connections terminated due to flood mitigation. The default limit is 100.\n NOTE: flood and abuse mitigation for upstream connections is presently enabled by the\n `envoy.reloadable_features.upstream_http2_flood_checks` flag."}, "max_inbound_window_update_frames_per_data_frame_sent": {"additionalProperties": true, "type": "integer", "description": "Limit the number of inbound WINDOW_UPDATE frames allowed per DATA frame sent. If the number\n of WINDOW_UPDATE frames received over the lifetime of connection exceeds the value calculated\n using this formula::\n\n     1 + 2 * (inbound_streams +\n              max_inbound_window_update_frames_per_data_frame_sent * outbound_data_frames)\n\n the connection is terminated. The ``http2.inbound_priority_frames_flood`` stat tracks\n the number of connections terminated due to flood mitigation. The default limit is 10.\n Setting this to 1 should be enough to support HTTP/2 implementations with basic flow control,\n but more complex implementations that try to estimate available bandwidth require at least 2.\n NOTE: flood and abuse mitigation for upstream connections is presently enabled by the\n `envoy.reloadable_features.upstream_http2_flood_checks` flag."}, "stream_error_on_invalid_http_messaging": {"type": "boolean", "description": "Allows invalid HTTP messaging and headers. When this option is disabled (default), then\n the whole HTTP/2 connection is terminated upon receiving invalid HEADERS frame. However,\n when this option is enabled, only the offending stream is terminated.\n\n This is overridden by HCM :ref:`stream_error_on_invalid_http_messaging\n <envoy_v3_api_field_extensions.filters.network.http_connection_manager.v3.HttpConnectionManager.stream_error_on_invalid_http_message>`\n iff present.\n\n This is deprecated in favor of :ref:`override_stream_error_on_invalid_http_message\n <envoy_v3_api_field_config.core.v3.Http2ProtocolOptions.override_stream_error_on_invalid_http_message>`\n\n See `RFC7540, sec. 8.1 <https://tools.ietf.org/html/rfc7540#section-8.1>`_ for details."}, "override_stream_error_on_invalid_http_message": {"additionalProperties": true, "type": "boolean", "description": "Allows invalid HTTP messaging and headers. When this option is disabled (default), then\n the whole HTTP/2 connection is terminated upon receiving invalid HEADERS frame. However,\n when this option is enabled, only the offending stream is terminated.\n\n This overrides any HCM :ref:`stream_error_on_invalid_http_messaging\n <envoy_v3_api_field_extensions.filters.network.http_connection_manager.v3.HttpConnectionManager.stream_error_on_invalid_http_message>`\n\n See `RFC7540, sec. 8.1 <https://tools.ietf.org/html/rfc7540#section-8.1>`_ for details."}, "custom_settings_parameters": {"items": {"$schema": "http://json-schema.org/draft-04/schema#", "properties": {"identifier": {"additionalProperties": true, "type": "integer", "description": "The 16 bit parameter identifier."}, "value": {"additionalProperties": true, "type": "integer", "description": "The 32 bit parameter value."}}, "additionalProperties": true, "type": "object", "description": "Defines a parameter to be sent in the SETTINGS frame.\n See `RFC7540, sec. 6.5.1 <https://tools.ietf.org/html/rfc7540#section-6.5.1>`_ for details."}, "type": "array", "description": "[#not-implemented-hide:]\n Specifies SETTINGS frame parameters to be sent to the peer, with two exceptions:\n\n 1. SETTINGS_ENABLE_PUSH (0x2) is not configurable as HTTP/2 server push is not supported by\n Envoy.\n\n 2. SETTINGS_ENABLE_CONNECT_PROTOCOL (0x8) is only configurable through the named field\n 'allow_connect'.\n\n Note that custom parameters specified through this field can not also be set in the\n corresponding named parameters:\n\n .. code-block:: text\n\n   ID    Field Name\n   ----------------\n   0x1   hpack_table_size\n   0x3   max_concurrent_streams\n   0x4   initial_stream_window_size\n\n Collisions will trigger config validation failure on load/update. Likewise, inconsistencies\n between custom parameters with the same identifier will trigger a failure.\n\n See `IANA HTTP/2 Settings\n <https://www.iana.org/assignments/http2-parameters/http2-parameters.xhtml#settings>`_ for\n standardized identifiers."}, "connection_keepalive": {"properties": {"interval": {"properties": {"seconds": {"type": "string", "description": "Signed seconds of the span of time. Must be from -315,576,000,000\n to +315,576,000,000 inclusive. Note: these bounds are computed from:\n 60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years"}, "nanos": {"type": "integer", "description": "Signed fractions of a second at nanosecond resolution of the span\n of time. Durations less than one second are represented with a 0\n `seconds` field and a positive or negative `nanos` field. For durations\n of one second or more, a non-zero value for the `nanos` field must be\n of the same sign as the `seconds` field. Must be from -999,999,999\n to +999,999,999 inclusive."}}, "additionalProperties": true, "type": "object", "description": "Send HTTP/2 PING frames at this period, in order to test that the connection is still alive."}, "timeout": {"properties": {"seconds": {"type": "string", "description": "Signed seconds of the span of time. Must be from -315,576,000,000\n to +315,576,000,000 inclusive. Note: these bounds are computed from:\n 60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years"}, "nanos": {"type": "integer", "description": "Signed fractions of a second at nanosecond resolution of the span\n of time. Durations less than one second are represented with a 0\n `seconds` field and a positive or negative `nanos` field. For durations\n of one second or more, a non-zero value for the `nanos` field must be\n of the same sign as the `seconds` field. Must be from -999,999,999\n to +999,999,999 inclusive."}}, "additionalProperties": true, "type": "object", "description": "How long to wait for a response to a keepalive PING. If a response is not received within this\n time period, the connection will be aborted."}, "interval_jitter": {"properties": {"value": {"type": "number"}}, "additionalProperties": true, "type": "object", "description": "A random jitter amount as a percentage of interval that will be added to each interval.\n A value of zero means there will be no jitter.\n The default value is 15%."}}, "additionalProperties": true, "type": "object", "description": "Send HTTP/2 PING frames to verify that the connection is still healthy. If the remote peer\n does not respond within the configured timeout, the connection will be aborted."}}, "additionalProperties": true, "type": "object", "description": "[#next-free-field: 16]", "id": "envoy.config.core.v3.Http2ProtocolOptions"}}}